{"ast":null,"code":"import { ref, computed, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useToast } from 'vue-toastification';\nexport default {\n  name: 'ProductsTab',\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n\n    // State for product list and filtering\n    const searchQuery = ref('');\n    const selectedCategory = ref('');\n    const searchTimeout = ref(null);\n\n    // State for modals\n    const showModal = ref(false);\n    const isEditing = ref(false);\n    const showDeleteModal = ref(false);\n    const productToDelete = ref(null);\n    const formSubmitting = ref(false);\n    const deleteSubmitting = ref(false);\n\n    // Product form state\n    const productForm = ref({\n      id: null,\n      title: '',\n      description: '',\n      price: 0,\n      category: '',\n      image: null,\n      image_url: ''\n    });\n    const newCategory = ref('');\n    const imagePreview = ref(null);\n\n    // Computed properties\n    const products = computed(() => store.getters['products/allProducts']);\n    const categories = computed(() => store.getters['products/categories']);\n    const loading = computed(() => store.getters.isLoading);\n    const filteredProducts = computed(() => {\n      let result = [...products.value];\n\n      // Filter by category\n      if (selectedCategory.value) {\n        result = result.filter(product => product.category === selectedCategory.value);\n      }\n\n      // Filter by search term\n      if (searchQuery.value) {\n        const searchLower = searchQuery.value.toLowerCase();\n        result = result.filter(product => product.title.toLowerCase().includes(searchLower) || product.description.toLowerCase().includes(searchLower));\n      }\n      return result;\n    });\n\n    // Methods for filtering\n    const debounceSearch = () => {\n      clearTimeout(searchTimeout.value);\n      searchTimeout.value = setTimeout(() => {\n        // No API call needed as we filter locally\n      }, 300);\n    };\n    const applyFilters = () => {\n      // No API call needed as we filter locally\n    };\n    const resetFilters = () => {\n      searchQuery.value = '';\n      selectedCategory.value = '';\n    };\n\n    // Methods for product form\n    const resetForm = () => {\n      productForm.value = {\n        id: null,\n        title: '',\n        description: '',\n        price: 0,\n        category: '',\n        image: null,\n        image_url: ''\n      };\n      newCategory.value = '';\n      imagePreview.value = null;\n    };\n    const showProductForm = product => {\n      resetForm();\n      if (product) {\n        // Edit existing product\n        productForm.value = {\n          id: product.id,\n          title: product.title,\n          description: product.description,\n          price: product.price,\n          category: product.category,\n          image: null,\n          image_url: product.image_url\n        };\n        isEditing.value = true;\n      } else {\n        // Add new product\n        isEditing.value = false;\n      }\n      showModal.value = true;\n    };\n    const closeModal = () => {\n      showModal.value = false;\n      resetForm();\n    };\n    const onImageChange = event => {\n      const file = event.target.files[0];\n      if (!file) return;\n      productForm.value.image = file;\n\n      // Generate preview\n      const reader = new FileReader();\n      reader.onload = e => {\n        imagePreview.value = e.target.result;\n      };\n      reader.readAsDataURL(file);\n    };\n    const saveProduct = async () => {\n      // Check if we need to use the new category\n      if (productForm.value.category === 'new' && newCategory.value) {\n        productForm.value.category = newCategory.value;\n      }\n      formSubmitting.value = true;\n      try {\n        if (isEditing.value) {\n          // Update existing product\n          const result = await store.dispatch('products/updateProduct', {\n            productId: productForm.value.id,\n            productData: productForm.value\n          });\n          if (result.success) {\n            // Success notification is handled by the store\n            closeModal();\n          }\n        } else {\n          // Create new product\n          const result = await store.dispatch('products/createProduct', productForm.value);\n          if (result.success) {\n            // Success notification is handled by the store\n            closeModal();\n          }\n        }\n      } catch (error) {\n        console.error('Error saving product:', error);\n        // Error notification is handled by the store\n      } finally {\n        formSubmitting.value = false;\n      }\n    };\n\n    // Methods for product deletion\n    const confirmDeleteProduct = product => {\n      productToDelete.value = product;\n      showDeleteModal.value = true;\n    };\n    const deleteProduct = async () => {\n      if (!productToDelete.value) return;\n      deleteSubmitting.value = true;\n      try {\n        const result = await store.dispatch('products/deleteProduct', productToDelete.value.id);\n        if (result.success) {\n          // Success notification is handled by the store\n          showDeleteModal.value = false;\n          productToDelete.value = null;\n        }\n      } catch (error) {\n        console.error('Error deleting product:', error);\n        // Error notification is handled by the store\n      } finally {\n        deleteSubmitting.value = false;\n      }\n    };\n\n    // Format helpers\n    const formatDate = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return new Intl.DateTimeFormat('ru-RU', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric'\n      }).format(date);\n    };\n    const formatPrice = price => {\n      return new Intl.NumberFormat('ru-RU').format(price);\n    };\n\n    // Lifecycle hooks\n    onMounted(async () => {\n      // Load products and categories\n      await Promise.all([store.dispatch('products/fetchProducts'), store.dispatch('products/fetchCategories')]);\n    });\n    return {\n      searchQuery,\n      selectedCategory,\n      showModal,\n      isEditing,\n      showDeleteModal,\n      productToDelete,\n      productForm,\n      newCategory,\n      imagePreview,\n      formSubmitting,\n      deleteSubmitting,\n      products,\n      filteredProducts,\n      categories,\n      loading,\n      debounceSearch,\n      applyFilters,\n      resetFilters,\n      showProductForm,\n      closeModal,\n      onImageChange,\n      saveProduct,\n      confirmDeleteProduct,\n      deleteProduct,\n      formatDate,\n      formatPrice\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useStore","useToast","name","setup","store","toast","searchQuery","selectedCategory","searchTimeout","showModal","isEditing","showDeleteModal","productToDelete","formSubmitting","deleteSubmitting","productForm","id","title","description","price","category","image","image_url","newCategory","imagePreview","products","getters","categories","loading","isLoading","filteredProducts","result","value","filter","product","searchLower","toLowerCase","includes","debounceSearch","clearTimeout","setTimeout","applyFilters","resetFilters","resetForm","showProductForm","closeModal","onImageChange","event","file","target","files","reader","FileReader","onload","e","readAsDataURL","saveProduct","dispatch","productId","productData","success","error","console","confirmDeleteProduct","deleteProduct","formatDate","dateString","date","Date","Intl","DateTimeFormat","day","month","year","format","formatPrice","NumberFormat","Promise","all"],"sources":["C:\\Users\\geeksaider\\VeloW\\frontend\\src\\views\\admin\\ProductsTab.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"flex justify-between items-center mb-8\">\n      <h2 class=\"text-xl font-medium text-gray-900\">Управление товарами</h2>\n      <button \n        @click=\"showProductForm(null)\" \n        class=\"py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition duration-150 text-sm font-medium flex items-center\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 4v16m8-8H4\" />\n        </svg>\n        Добавить товар\n      </button>\n    </div>\n    \n    <div v-if=\"loading\" class=\"flex justify-center items-center py-32\">\n      <div class=\"animate-spin h-12 w-12 border-3 border-indigo-500 border-t-transparent rounded-full\"></div>\n    </div>\n    \n    <div v-else>\n      <!-- Search and Filters -->\n      <div class=\"bg-gray-50 rounded-xl p-6 mb-8\">\n        <div class=\"flex flex-wrap gap-4\">\n          <div class=\"w-full md:w-auto flex-1\">\n            <div class=\"relative\">\n              <div class=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                </svg>\n              </div>\n              <input \n                type=\"text\" \n                v-model=\"searchQuery\" \n                placeholder=\"Поиск товаров...\" \n                class=\"block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\"\n                @input=\"debounceSearch\"\n              >\n            </div>\n          </div>\n          \n          <div class=\"w-full md:w-auto md:flex-1\">\n            <select \n              v-model=\"selectedCategory\" \n              class=\"block w-full py-2 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\" \n              @change=\"applyFilters\"\n            >\n              <option value=\"\">Все категории</option>\n              <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\n                {{ category }}\n              </option>\n            </select>\n          </div>\n          \n          <button \n            class=\"py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl transition duration-150 text-sm font-medium w-full md:w-auto\" \n            @click=\"resetFilters\"\n          >\n            Сбросить\n          </button>\n        </div>\n      </div>\n      \n      <!-- Products List -->\n      <div v-if=\"filteredProducts.length === 0\" class=\"text-center py-16 bg-white rounded-2xl shadow-sm\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-16 w-16 mx-auto text-gray-300 mb-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\n        </svg>\n        <p class=\"text-gray-500 text-lg\">Товары не найдены</p>\n      </div>\n      \n      <div v-else class=\"overflow-x-auto bg-white rounded-2xl shadow-sm\">\n        <table class=\"min-w-full divide-y divide-gray-200\">\n          <thead class=\"bg-gray-50\">\n            <tr>\n              <th scope=\"col\" class=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Товар\n              </th>\n              <th scope=\"col\" class=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Категория\n              </th>\n              <th scope=\"col\" class=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Цена\n              </th>\n              <th scope=\"col\" class=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Дата создания\n              </th>\n              <th scope=\"col\" class=\"px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Действия\n              </th>\n            </tr>\n          </thead>\n          <tbody class=\"bg-white divide-y divide-gray-200\">\n            <tr v-for=\"product in filteredProducts\" :key=\"product.id\" class=\"hover:bg-gray-50 transition duration-150\">\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <div class=\"flex items-center\">\n                  <div class=\"h-12 w-12 flex-shrink-0 mr-4 rounded-lg overflow-hidden bg-gray-100\">\n                    <img \n                      :src=\"product.image_url || 'https://via.placeholder.com/40x40?text=Нет+изображения'\" \n                      :alt=\"product.title\" \n                      class=\"h-12 w-12 object-cover\"\n                    >\n                  </div>\n                  <div>\n                    <div class=\"text-sm font-medium text-gray-900 mb-1\">{{ product.title }}</div>\n                    <div class=\"text-sm text-gray-500 truncate max-w-xs\">{{ product.description.substring(0, 50) }}{{ product.description.length > 50 ? '...' : '' }}</div>\n                  </div>\n                </div>\n              </td>\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <span class=\"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full\">\n                  {{ product.category }}\n                </span>\n              </td>\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <div class=\"text-sm font-medium text-gray-900\">{{ formatPrice(product.price) }} ₽</div>\n              </td>\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <div class=\"text-sm text-gray-500\">{{ formatDate(product.created_at) }}</div>\n              </td>\n              <td class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                <button \n                  @click=\"showProductForm(product)\" \n                  class=\"inline-flex items-center justify-center p-2 text-gray-600 hover:text-indigo-600 hover:bg-gray-100 rounded-full transition-colors duration-150 mr-1\"\n                  title=\"Редактировать\"\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\n                  </svg>\n                </button>\n                <button \n                  @click=\"confirmDeleteProduct(product)\" \n                  class=\"inline-flex items-center justify-center p-2 text-gray-600 hover:text-red-600 hover:bg-gray-100 rounded-full transition-colors duration-150\"\n                  title=\"Удалить\"\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                  </svg>\n                </button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n    \n    <!-- Product Form Modal -->\n    <div \n      v-if=\"showModal\" \n      class=\"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-40\"\n    >\n      <div class=\"bg-white rounded-2xl shadow-sm w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <div class=\"p-8\">\n          <div class=\"flex justify-between items-center mb-8\">\n            <h3 class=\"text-xl font-medium text-gray-900\">\n              {{ isEditing ? 'Редактирование товара' : 'Добавление товара' }}\n            </h3>\n            <button \n              @click=\"closeModal\" \n              class=\"inline-flex items-center justify-center p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors duration-150\"\n            >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n          \n          <form @submit.prevent=\"saveProduct\">\n            <div class=\"mb-6\">\n              <label for=\"title\" class=\"block text-sm font-medium text-gray-700 mb-2\">Название товара</label>\n              <input \n                id=\"title\" \n                type=\"text\" \n                v-model=\"productForm.title\" \n                class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\" \n                required\n              >\n            </div>\n            \n            <div class=\"mb-6\">\n              <label for=\"description\" class=\"block text-sm font-medium text-gray-700 mb-2\">Описание</label>\n              <textarea \n                id=\"description\" \n                v-model=\"productForm.description\" \n                class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm h-32\" \n                required\n              ></textarea>\n            </div>\n            \n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n              <div>\n                <label for=\"price\" class=\"block text-sm font-medium text-gray-700 mb-2\">Цена (₽)</label>\n                <input \n                  id=\"price\" \n                  type=\"number\" \n                  v-model.number=\"productForm.price\" \n                  class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\" \n                  min=\"0\" \n                  step=\"0.01\" \n                  required\n                >\n              </div>\n              \n              <div>\n                <label for=\"category\" class=\"block text-sm font-medium text-gray-700 mb-2\">Категория</label>\n                <select \n                  id=\"category\" \n                  v-model=\"productForm.category\" \n                  class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\"\n                  required\n                >\n                  <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\n                    {{ category }}\n                  </option>\n                  <option value=\"new\">+ Добавить новую категорию</option>\n                </select>\n              </div>\n            </div>\n            \n            <div v-if=\"productForm.category === 'new'\" class=\"mb-6\">\n              <label for=\"newCategory\" class=\"block text-sm font-medium text-gray-700 mb-2\">Новая категория</label>\n              <input \n                id=\"newCategory\" \n                type=\"text\" \n                v-model=\"newCategory\" \n                class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm\" \n                required\n              >\n            </div>\n            \n            <div class=\"mb-8\">\n              <label for=\"image\" class=\"block text-sm font-medium text-gray-700 mb-2\">Изображение</label>\n              <div class=\"flex items-center\">\n                <label class=\"block w-full py-3 px-4 border border-gray-200 rounded-xl text-sm text-gray-500 cursor-pointer hover:bg-gray-50 transition-colors duration-150\">\n                  <span class=\"flex items-center\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 mr-2 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                    </svg>\n                    Выбрать файл\n                  </span>\n                  <input \n                    id=\"image\" \n                    type=\"file\" \n                    @change=\"onImageChange\" \n                    accept=\"image/*\" \n                    class=\"hidden\"\n                  >\n                </label>\n              </div>\n              <div v-if=\"imagePreview || productForm.image_url\" class=\"mt-4\">\n                <div class=\"w-32 h-32 rounded-xl overflow-hidden bg-gray-100 border border-gray-200\">\n                  <img \n                    :src=\"imagePreview || productForm.image_url\" \n                    alt=\"Предварительный просмотр\" \n                    class=\"w-full h-full object-cover\"\n                  >\n                </div>\n              </div>\n            </div>\n            \n            <div class=\"flex justify-end gap-4\">\n              <button \n                type=\"button\" \n                @click=\"closeModal\" \n                class=\"py-3 px-6 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl transition duration-150 text-sm font-medium\"\n              >\n                Отмена\n              </button>\n              <button \n                type=\"submit\" \n                :disabled=\"formSubmitting\" \n                class=\"py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition duration-150 text-sm font-medium flex items-center justify-center\"\n              >\n                <span v-if=\"formSubmitting\" class=\"flex items-center\">\n                  <svg class=\"animate-spin -ml-1 mr-2 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                    <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n                    <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                  </svg>\n                  Сохранение...\n                </span>\n                <span v-else>Сохранить</span>\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Delete Confirmation Modal -->\n    <div \n      v-if=\"showDeleteModal\" \n      class=\"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-40\"\n    >\n      <div class=\"bg-white rounded-2xl shadow-sm p-8 max-w-md w-full\">\n        <div class=\"text-center mb-6\">\n          <div class=\"inline-flex items-center justify-center h-16 w-16 rounded-full bg-red-100 text-red-500 mb-4\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n            </svg>\n          </div>\n          <h3 class=\"text-xl font-medium text-gray-900 mb-2\">Подтверждение удаления</h3>\n          <p class=\"text-gray-500 mb-6\">Вы действительно хотите удалить товар \"{{ productToDelete?.title }}\"? Это действие нельзя отменить.</p>\n        </div>\n        \n        <div class=\"flex justify-center gap-4\">\n          <button \n            @click=\"showDeleteModal = false\" \n            class=\"py-3 px-6 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl transition duration-150 text-sm font-medium\"\n          >\n            Отмена\n          </button>\n          <button \n            @click=\"deleteProduct\" \n            :disabled=\"deleteSubmitting\"\n            class=\"py-3 px-6 bg-red-600 hover:bg-red-700 text-white rounded-xl transition duration-150 text-sm font-medium flex items-center justify-center\"\n          >\n            <span v-if=\"deleteSubmitting\" class=\"flex items-center\">\n              <svg class=\"animate-spin -ml-1 mr-2 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n                <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n              </svg>\n              Удаление...\n            </span>\n            <span v-else>Удалить</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useToast } from 'vue-toastification';\n\nexport default {\n  name: 'ProductsTab',\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n    \n    // State for product list and filtering\n    const searchQuery = ref('');\n    const selectedCategory = ref('');\n    const searchTimeout = ref(null);\n    \n    // State for modals\n    const showModal = ref(false);\n    const isEditing = ref(false);\n    const showDeleteModal = ref(false);\n    const productToDelete = ref(null);\n    const formSubmitting = ref(false);\n    const deleteSubmitting = ref(false);\n    \n    // Product form state\n    const productForm = ref({\n      id: null,\n      title: '',\n      description: '',\n      price: 0,\n      category: '',\n      image: null,\n      image_url: ''\n    });\n    const newCategory = ref('');\n    const imagePreview = ref(null);\n    \n    // Computed properties\n    const products = computed(() => store.getters['products/allProducts']);\n    const categories = computed(() => store.getters['products/categories']);\n    const loading = computed(() => store.getters.isLoading);\n    \n    const filteredProducts = computed(() => {\n      let result = [...products.value];\n      \n      // Filter by category\n      if (selectedCategory.value) {\n        result = result.filter(product => product.category === selectedCategory.value);\n      }\n      \n      // Filter by search term\n      if (searchQuery.value) {\n        const searchLower = searchQuery.value.toLowerCase();\n        result = result.filter(product => \n          product.title.toLowerCase().includes(searchLower) || \n          product.description.toLowerCase().includes(searchLower)\n        );\n      }\n      \n      return result;\n    });\n    \n    // Methods for filtering\n    const debounceSearch = () => {\n      clearTimeout(searchTimeout.value);\n      searchTimeout.value = setTimeout(() => {\n        // No API call needed as we filter locally\n      }, 300);\n    };\n    \n    const applyFilters = () => {\n      // No API call needed as we filter locally\n    };\n    \n    const resetFilters = () => {\n      searchQuery.value = '';\n      selectedCategory.value = '';\n    };\n    \n    // Methods for product form\n    const resetForm = () => {\n      productForm.value = {\n        id: null,\n        title: '',\n        description: '',\n        price: 0,\n        category: '',\n        image: null,\n        image_url: ''\n      };\n      newCategory.value = '';\n      imagePreview.value = null;\n    };\n    \n    const showProductForm = (product) => {\n      resetForm();\n      \n      if (product) {\n        // Edit existing product\n        productForm.value = {\n          id: product.id,\n          title: product.title,\n          description: product.description,\n          price: product.price,\n          category: product.category,\n          image: null,\n          image_url: product.image_url\n        };\n        isEditing.value = true;\n      } else {\n        // Add new product\n        isEditing.value = false;\n      }\n      \n      showModal.value = true;\n    };\n    \n    const closeModal = () => {\n      showModal.value = false;\n      resetForm();\n    };\n    \n    const onImageChange = (event) => {\n      const file = event.target.files[0];\n      if (!file) return;\n      \n      productForm.value.image = file;\n      \n      // Generate preview\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        imagePreview.value = e.target.result;\n      };\n      reader.readAsDataURL(file);\n    };\n    \n    const saveProduct = async () => {\n      // Check if we need to use the new category\n      if (productForm.value.category === 'new' && newCategory.value) {\n        productForm.value.category = newCategory.value;\n      }\n      \n      formSubmitting.value = true;\n      \n      try {\n        if (isEditing.value) {\n          // Update existing product\n          const result = await store.dispatch('products/updateProduct', {\n            productId: productForm.value.id,\n            productData: productForm.value\n          });\n          \n          if (result.success) {\n            // Success notification is handled by the store\n            closeModal();\n          }\n        } else {\n          // Create new product\n          const result = await store.dispatch('products/createProduct', productForm.value);\n          \n          if (result.success) {\n            // Success notification is handled by the store\n            closeModal();\n          }\n        }\n      } catch (error) {\n        console.error('Error saving product:', error);\n        // Error notification is handled by the store\n      } finally {\n        formSubmitting.value = false;\n      }\n    };\n    \n    // Methods for product deletion\n    const confirmDeleteProduct = (product) => {\n      productToDelete.value = product;\n      showDeleteModal.value = true;\n    };\n    \n    const deleteProduct = async () => {\n      if (!productToDelete.value) return;\n      \n      deleteSubmitting.value = true;\n      \n      try {\n        const result = await store.dispatch('products/deleteProduct', productToDelete.value.id);\n        \n        if (result.success) {\n          // Success notification is handled by the store\n          showDeleteModal.value = false;\n          productToDelete.value = null;\n        }\n      } catch (error) {\n        console.error('Error deleting product:', error);\n        // Error notification is handled by the store\n      } finally {\n        deleteSubmitting.value = false;\n      }\n    };\n    \n    // Format helpers\n    const formatDate = (dateString) => {\n      if (!dateString) return '';\n      \n      const date = new Date(dateString);\n      return new Intl.DateTimeFormat('ru-RU', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric'\n      }).format(date);\n    };\n    \n    const formatPrice = (price) => {\n      return new Intl.NumberFormat('ru-RU').format(price);\n    };\n    \n    // Lifecycle hooks\n    onMounted(async () => {\n      // Load products and categories\n      await Promise.all([\n        store.dispatch('products/fetchProducts'),\n        store.dispatch('products/fetchCategories')\n      ]);\n    });\n    \n    return {\n      searchQuery,\n      selectedCategory,\n      showModal,\n      isEditing,\n      showDeleteModal,\n      productToDelete,\n      productForm,\n      newCategory,\n      imagePreview,\n      formSubmitting,\n      deleteSubmitting,\n      products,\n      filteredProducts,\n      categories,\n      loading,\n      debounceSearch,\n      applyFilters,\n      resetFilters,\n      showProductForm,\n      closeModal,\n      onImageChange,\n      saveProduct,\n      confirmDeleteProduct,\n      deleteProduct,\n      formatDate,\n      formatPrice\n    };\n  }\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}