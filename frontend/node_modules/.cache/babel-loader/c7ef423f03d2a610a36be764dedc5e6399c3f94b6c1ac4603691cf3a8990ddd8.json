{"ast":null,"code":"import { ref, computed, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useToast } from 'vue-toastification';\nexport default {\n  name: 'ShopView',\n  setup() {\n    const store = useStore();\n    const route = useRoute();\n    const router = useRouter();\n    const toast = useToast();\n\n    // State\n    const searchQuery = ref('');\n    const selectedCategory = ref('');\n    const sortOrder = ref('default');\n    const searchTimeout = ref(null);\n\n    // Computed properties\n    const products = computed(() => store.getters['products/filteredProducts']);\n    const categories = computed(() => store.getters['products/categories']);\n    const loading = computed(() => store.getters.isLoading);\n\n    // Methods\n    const fetchData = async () => {\n      await Promise.all([store.dispatch('products/fetchProducts'), store.dispatch('products/fetchCategories')]);\n    };\n    const debounceSearch = () => {\n      clearTimeout(searchTimeout.value);\n      searchTimeout.value = setTimeout(() => {\n        applyFilters();\n      }, 500);\n    };\n    const applyFilters = () => {\n      // Update route query parameters\n      router.push({\n        query: {\n          ...route.query,\n          search: searchQuery.value || undefined,\n          category: selectedCategory.value || undefined,\n          sort: sortOrder.value !== 'default' ? sortOrder.value : undefined\n        }\n      });\n\n      // Apply filters in Vuex\n      store.dispatch('products/updateFilter', {\n        key: 'search',\n        value: searchQuery.value\n      });\n      store.dispatch('products/updateFilter', {\n        key: 'category',\n        value: selectedCategory.value\n      });\n      store.dispatch('products/updateFilter', {\n        key: 'sort',\n        value: sortOrder.value\n      });\n    };\n    const resetFilters = () => {\n      searchQuery.value = '';\n      selectedCategory.value = '';\n      sortOrder.value = 'default';\n      router.push({\n        query: {}\n      });\n      store.dispatch('products/resetFilters');\n    };\n    const addToCart = product => {\n      store.dispatch('cart/addToCart', {\n        product,\n        quantity: 1\n      });\n    };\n    const formatPrice = price => {\n      return new Intl.NumberFormat('ru-RU').format(price);\n    };\n\n    // Lifecycle hooks\n    onMounted(async () => {\n      // Apply query parameters from URL if they exist\n      if (route.query.search) {\n        searchQuery.value = route.query.search;\n        store.dispatch('products/updateFilter', {\n          key: 'search',\n          value: route.query.search\n        });\n      }\n      if (route.query.category) {\n        selectedCategory.value = route.query.category;\n        store.dispatch('products/updateFilter', {\n          key: 'category',\n          value: route.query.category\n        });\n      }\n      if (route.query.sort) {\n        sortOrder.value = route.query.sort;\n        store.dispatch('products/updateFilter', {\n          key: 'sort',\n          value: route.query.sort\n        });\n      }\n      await fetchData();\n    });\n\n    // Watch for route query changes from external sources\n    watch(() => route.query, newQuery => {\n      if (newQuery.search !== undefined && newQuery.search !== searchQuery.value) {\n        searchQuery.value = newQuery.search;\n      }\n      if (newQuery.category !== undefined && newQuery.category !== selectedCategory.value) {\n        selectedCategory.value = newQuery.category;\n      }\n      if (newQuery.sort !== undefined && newQuery.sort !== sortOrder.value) {\n        sortOrder.value = newQuery.sort;\n      }\n    }, {\n      deep: true\n    });\n    return {\n      searchQuery,\n      selectedCategory,\n      sortOrder,\n      products,\n      categories,\n      loading,\n      applyFilters,\n      debounceSearch,\n      resetFilters,\n      addToCart,\n      formatPrice\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useStore","useRoute","useRouter","useToast","name","setup","store","route","router","toast","searchQuery","selectedCategory","sortOrder","searchTimeout","products","getters","categories","loading","isLoading","fetchData","Promise","all","dispatch","debounceSearch","clearTimeout","value","setTimeout","applyFilters","push","query","search","undefined","category","sort","key","resetFilters","addToCart","product","quantity","formatPrice","price","Intl","NumberFormat","format","newQuery","deep"],"sources":["C:\\Users\\geeksaider\\VeloW\\frontend\\src\\views\\ShopView.vue"],"sourcesContent":["<template>\n  <div class=\"container mx-auto px-4 py-8\">\n    <h1 class=\"text-3xl font-bold mb-8\">Каталог товаров</h1>\n    \n    <!-- Filters and Search -->\n    <div class=\"bg-white rounded-lg shadow-md p-6 mb-8\">\n      <div class=\"flex flex-wrap gap-4 items-end\">\n        <div class=\"w-full md:w-auto flex-1\">\n          <label for=\"search\" class=\"form-label\">Поиск</label>\n          <input \n            type=\"text\" \n            id=\"search\" \n            v-model=\"searchQuery\" \n            placeholder=\"Поиск товаров...\" \n            class=\"form-input\"\n            @input=\"debounceSearch\"\n          >\n        </div>\n        \n        <div class=\"w-full md:w-auto md:flex-1\">\n          <label for=\"category\" class=\"form-label\">Категория</label>\n          <select id=\"category\" v-model=\"selectedCategory\" class=\"form-input\" @change=\"applyFilters\">\n            <option value=\"\">Все категории</option>\n            <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\n              {{ category }}\n            </option>\n          </select>\n        </div>\n        \n        <div class=\"w-full md:w-auto md:flex-1\">\n          <label for=\"sort\" class=\"form-label\">Сортировка</label>\n          <select id=\"sort\" v-model=\"sortOrder\" class=\"form-input\" @change=\"applyFilters\">\n            <option value=\"default\">По умолчанию</option>\n            <option value=\"price-low\">Сначала дешевые</option>\n            <option value=\"price-high\">Сначала дорогие</option>\n          </select>\n        </div>\n        \n        <button \n          class=\"btn btn-secondary w-full md:w-auto md:self-end\" \n          @click=\"resetFilters\"\n        >\n          Сбросить фильтры\n        </button>\n      </div>\n    </div>\n    \n    <!-- Products Grid -->\n    <div v-if=\"loading\" class=\"flex justify-center py-12\">\n      <div class=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-slate-600\"></div>\n    </div>\n    \n    <div v-else-if=\"products.length === 0\" class=\"text-center py-12\">\n      <p class=\"text-xl text-slate-600\">Товары не найдены</p>\n      <button class=\"btn btn-primary mt-4\" @click=\"resetFilters\">Сбросить фильтры</button>\n    </div>\n    \n    <div v-else class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n      <div \n        v-for=\"product in products\" \n        :key=\"product.id\" \n        class=\"card product-card group\"\n      >\n        <div class=\"relative h-56 mb-4 overflow-hidden rounded-md\">\n          <img \n            :src=\"product.image_url || 'https://via.placeholder.com/300x300?text=Нет+изображения'\" \n            :alt=\"product.title\" \n            class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n          >\n          <div class=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center\">\n            <div class=\"transform translate-y-8 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300\">\n              <router-link \n                :to=\"`/product/${product.id}`\" \n                class=\"bg-white text-slate-800 px-4 py-2 rounded-md font-medium hover:bg-slate-100 transition-colors\"\n              >\n                Подробнее\n              </router-link>\n            </div>\n          </div>\n        </div>\n        \n        <h3 class=\"font-semibold text-lg text-slate-800 mb-2\">{{ product.title }}</h3>\n        <p class=\"text-slate-600 mb-3 text-sm line-clamp-2\">{{ product.description }}</p>\n        \n        <div class=\"flex items-center justify-between mt-auto\">\n          <span class=\"font-bold text-slate-800\">{{ formatPrice(product.price) }} ₽</span>\n          <button \n            class=\"btn-primary text-sm px-3 py-1 rounded\" \n            @click=\"addToCart(product)\"\n          >\n            В корзину\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useToast } from 'vue-toastification';\n\nexport default {\n  name: 'ShopView',\n  setup() {\n    const store = useStore();\n    const route = useRoute();\n    const router = useRouter();\n    const toast = useToast();\n    \n    // State\n    const searchQuery = ref('');\n    const selectedCategory = ref('');\n    const sortOrder = ref('default');\n    const searchTimeout = ref(null);\n    \n    // Computed properties\n    const products = computed(() => store.getters['products/filteredProducts']);\n    const categories = computed(() => store.getters['products/categories']);\n    const loading = computed(() => store.getters.isLoading);\n    \n    // Methods\n    const fetchData = async () => {\n      await Promise.all([\n        store.dispatch('products/fetchProducts'),\n        store.dispatch('products/fetchCategories')\n      ]);\n    };\n    \n    const debounceSearch = () => {\n      clearTimeout(searchTimeout.value);\n      searchTimeout.value = setTimeout(() => {\n        applyFilters();\n      }, 500);\n    };\n    \n    const applyFilters = () => {\n      // Update route query parameters\n      router.push({\n        query: {\n          ...route.query,\n          search: searchQuery.value || undefined,\n          category: selectedCategory.value || undefined,\n          sort: sortOrder.value !== 'default' ? sortOrder.value : undefined\n        }\n      });\n      \n      // Apply filters in Vuex\n      store.dispatch('products/updateFilter', { key: 'search', value: searchQuery.value });\n      store.dispatch('products/updateFilter', { key: 'category', value: selectedCategory.value });\n      store.dispatch('products/updateFilter', { key: 'sort', value: sortOrder.value });\n    };\n    \n    const resetFilters = () => {\n      searchQuery.value = '';\n      selectedCategory.value = '';\n      sortOrder.value = 'default';\n      \n      router.push({ query: {} });\n      \n      store.dispatch('products/resetFilters');\n    };\n    \n    const addToCart = (product) => {\n      store.dispatch('cart/addToCart', { product, quantity: 1 });\n    };\n    \n    const formatPrice = (price) => {\n      return new Intl.NumberFormat('ru-RU').format(price);\n    };\n    \n    // Lifecycle hooks\n    onMounted(async () => {\n      // Apply query parameters from URL if they exist\n      if (route.query.search) {\n        searchQuery.value = route.query.search;\n        store.dispatch('products/updateFilter', { key: 'search', value: route.query.search });\n      }\n      \n      if (route.query.category) {\n        selectedCategory.value = route.query.category;\n        store.dispatch('products/updateFilter', { key: 'category', value: route.query.category });\n      }\n      \n      if (route.query.sort) {\n        sortOrder.value = route.query.sort;\n        store.dispatch('products/updateFilter', { key: 'sort', value: route.query.sort });\n      }\n      \n      await fetchData();\n    });\n    \n    // Watch for route query changes from external sources\n    watch(() => route.query, (newQuery) => {\n      if (newQuery.search !== undefined && newQuery.search !== searchQuery.value) {\n        searchQuery.value = newQuery.search;\n      }\n      \n      if (newQuery.category !== undefined && newQuery.category !== selectedCategory.value) {\n        selectedCategory.value = newQuery.category;\n      }\n      \n      if (newQuery.sort !== undefined && newQuery.sort !== sortOrder.value) {\n        sortOrder.value = newQuery.sort;\n      }\n    }, { deep: true });\n    \n    return {\n      searchQuery,\n      selectedCategory,\n      sortOrder,\n      products,\n      categories,\n      loading,\n      applyFilters,\n      debounceSearch,\n      resetFilters,\n      addToCart,\n      formatPrice\n    };\n  }\n};\n</script>\n\n<style scoped>\n.product-card {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}